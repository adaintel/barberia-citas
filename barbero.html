<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel del Barbero | Barbería Elite</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.css">

  <!-- ******************** CSS ******************** -->
  <style>
    :root {
      --gold: #D4AF37;
      --dark: #121212;
      --darker: #0a0a0a;
      --light: #f8f8f8;
      --glass: rgba(255, 255, 255, 0.05);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Montserrat', sans-serif;
    }
    
    body {
      margin: 0;
      padding: 0;
      position: relative;
      background-color: var(--dark);
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(212, 175, 55, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 80% 70%, rgba(212, 175, 55, 0.1) 0%, transparent 20%),
        /* Estilización de la letra K */
        linear-gradient(to bottom, transparent 45%, rgba(212, 175, 55, 0.05) 45%, rgba(212, 175, 55, 0.05) 55%, transparent 55%),
        linear-gradient(to right, transparent 45%, rgba(212, 175, 55, 0.05) 45%, rgba(212, 175, 55, 0.05) 55%, transparent 55%),
        linear-gradient(135deg, transparent 45%, rgba(212, 175, 55, 0.05) 45%, rgba(212, 175, 55, 0.05) 55%, transparent 55%);
      background-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, 100% 100%;
      background-position: 0 0, 0 0, center center, center center, center center;
      background-repeat: no-repeat;
    }
    
    .container {
      position: relative;
      z-index: 1;
    }
    
    .glass-panel {
      background: rgba(0, 0, 0, 0.7);
      border-radius: 15px;
      border: 1px solid var(--gold);
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      margin-top: 0 !important;
      backdrop-filter: blur(5px);
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .glass-panel:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
    }
    
    .glass-panel::before {
      content: "K";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 30vw;
      font-weight: bold;
      color: rgba(212, 175, 55, 0.03);
      z-index: -1;
      pointer-events: none;
    }
    
    header {
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(212, 175, 55, 0.2);
      margin-top: 0 !important;
    }

    header {
      position: relative;
      text-align: center;
      margin-bottom: 2rem;
      padding: 1.5rem 1rem;
      border-bottom: 1px solid rgba(212, 175, 55, 0.2);
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      backdrop-filter: blur(5px);
    }
    
    header h1 {
      color: var(--gold);
      font-size: 2.2rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    
    header p {
      color: var(--light);
      opacity: 0.8;
      letter-spacing: 1px;
    }
    
    .panel-control {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 25px;
      align-items: center;
    }
    
    .search-container {
      position: relative;
      flex-grow: 1;
      min-width: 250px;
    }
    
    .search-container i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gold);
    }
    
    #buscador {
      width: 100%;
      padding: 12px 15px 12px 45px;
      border: none;
      border-radius: 8px;
      background-color: rgba(0, 0, 0, 0.3);
      color: white;
      border: 1px solid rgba(212, 175, 55, 0.3);
      transition: all 0.3s ease;
    }
    
    #buscador:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
    }
    
    .filters {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    select {
      padding: 10px 15px;
      border-radius: 8px;
      background-color: rgba(0, 0, 0, 0.3);
      color: white;
      border: 1px solid rgba(212, 175, 55, 0.3);
      min-width: 150px;
      transition: all 0.3s ease;
    }
    
    select:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
    }
    
    .btn-export {
      background: var(--gold);
      color: var(--darker);
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: bold;
      transition: all 0.3s;
    }
    
    .btn-export:hover {
      background: #c9a227;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
    }
    
    .table-responsive {
      overflow-x: auto;
      margin-top: 1.5rem;
    }
    
    .tabla-citas {
      width: 100%;
      border-collapse: collapse;
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .tabla-citas th {
      background-color: rgba(212, 175, 55, 0.2);
      color: var(--gold);
      padding: 15px;
      text-align: left;
    }
    
    .tabla-citas td {
      color: #ff4d4d !important;
      font-weight: 500;
      text-shadow: 0 0 2px rgba(255, 77, 77, 0.2);
      transition: all 0.2s ease;
    }

    /* Nuevos estilos para nombres de clientes - Agregar después de .tabla-citas td */
    .tabla-citas td:first-child {
      color: #ff4d4d;
      font-weight: 600;
      text-shadow: 0 0 3px rgba(255, 77, 77, 0.3); 
    }

    .tabla-citas tr:hover td:first-child {
      color: #ff3333 !important;
      text-shadow: 0 0 4px rgba(255, 77, 77, 0.4);
    }
    
    .tabla-citas tr:last-child td {
      border-bottom: none;
    }
    
    .tabla-citas tr:hover {
      background-color: rgba(212, 175, 55, 0.05);
    }
    
    .tabla-citas tr:hover td {
      transform: translateX(5px);
    }
    
    .estado-cita {
      font-weight: bold;
      text-transform: capitalize;
    }
    
    .estado-cita[data-estado="pendiente"] {
      color: #f39c12;
    }
    
    .estado-cita[data-estado="completado"] {
      color: #27ae60;
    }
    
    .estado-cita[data-estado="cancelado"] {
      color: #e74c3c;
    }
    
    .acciones {
      display: flex;
      gap: 8px;
    }
    
    .btn-accion {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    
    .btn-completar {
      color: #27ae60;
      border: 1px solid #27ae60;
    }
    
    .btn-completar:hover {
      background: #27ae60;
      color: white;
      transform: scale(1.1);
    }
    
    .btn-cancelar {
      color: #e74c3c;
      border: 1px solid #e74c3c;
    }
    
    .btn-cancelar:hover {
      background: #e74c3c;
      color: white;
      transform: scale(1.1);
    }
    
    .btn-detalles {
      color: var(--gold);
      border: 1px solid var(--gold);
    }
    
    .btn-detalles:hover {
      background: var(--gold);
      color: var(--dark);
      transform: scale(1.1);
    }
    
    .btn-eliminar {
      color: #ff4d4d;
      border: 1px solid #ff4d4d;
    }
    
    .btn-eliminar:hover {
      background: #ff4d4d;
      color: white;
      transform: scale(1.1);
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 2rem;
    }
    
    .stat-card {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(212, 175, 55, 0.2);
      border-radius: 10px;
      padding: 1.5rem;
      text-align: center;
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
    }
    
    .stat-card:hover {
      transform: translateY(-5px) scale(1.02);
      border-color: var(--gold);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      background: rgba(0, 0, 0, 0.4);
    }
    
    .stat-card h3 {
      color: var(--gold);
      margin-bottom: 10px;
      font-size: 1rem;
    }
    
    .stat-card p {
      font-size: 2rem;
      font-weight: bold;
      color: var(--light);
    }
    
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      color: var(--gold);
    }
    
    .loading i {
      font-size: 2rem;
      margin-bottom: 1rem;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .mensaje-error {
      background: rgba(231, 76, 60, 0.2);
      color: #e74c3c;
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      text-align: center;
      border: 1px solid rgba(231, 76, 60, 0.3);
    }
    
    .btn-reintentar {
      background: var(--gold);
      color: var(--dark);
      border: none;
      padding: 8px 15px;
      margin-top: 10px;
      border-radius: 5px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: all 0.3s;
    }
    
    .btn-reintentar:hover {
      background: #c9a227;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 1000;
    }
    
    .modal-content {
      background-color: var(--darker);
      padding: 2rem;
      border-radius: 10px;
      border: 1px solid var(--gold);
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: modalFadeIn 0.3s;
    }
    
    @keyframes modalFadeIn {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }
    
    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 1.5rem;
      color: var(--gold);
      cursor: pointer;
      transition: transform 0.3s;
    }
    
    .close-modal:hover {
      transform: rotate(90deg);
    }
    
    .modal-content h2 {
      color: var(--gold);
      margin-bottom: 1.5rem;
      text-align: center;
    }
    
    .detalle-item {
      margin-bottom: 1rem;
    }
    
    .detalle-item h3 {
      color: var(--gold);
      margin-bottom: 0.3rem;
      font-size: 0.9rem;
    }
    
    .detalle-item p {
      color: #ff4d4d;
      font-size: 1.1rem;
      font-weight: 500;
    }
    
    .modal-verificacion {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .contenido-verificacion {
      background-color: var(--darker);
      padding: 2rem;
      border-radius: 10px;
      border: 1px solid var(--gold);
      max-width: 400px;
      width: 90%;
      text-align: center;
      animation: modalFadeIn 0.3s;
    }
    
    .contenido-verificacion h2 {
      color: var(--gold);
      margin-bottom: 1rem;
    }
    
    .contenido-verificacion input {
      width: 100%;
      padding: 10px;
      margin: 1rem 0;
      border-radius: 5px;
      border: 1px solid var(--gold);
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      transition: all 0.3s;
    }
    
    .contenido-verificacion input:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
    }
    
    .btn-verificar {
      background-color: var(--gold);
      color: var(--dark);
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      width: 100%;
    }
    
    .btn-verificar:hover {
      background-color: #c9a227;
      transform: translateY(-2px);
    }
    
    .btn-verificar:active {
      transform: translateY(0);
    }
    
    .mensaje-error-verificacion {
      color: #e74c3c;
      margin-top: 10px;
      display: none;
    }
    
    footer {
      margin-top: 2rem;
      text-align: center;
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
    }
    
    .btn-volver {
      background: rgba(212, 175, 55, 0.1);
      color: var(--gold);
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
      border: 1px solid rgba(212, 175, 55, 0.3);
    }
    
    .btn-volver:hover {
      background: rgba(212, 175, 55, 0.2);
      transform: translateY(-2px);
    }
    
    .gold-glow {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0) 70%);
      transform: translate(-50%, -50%);
      z-index: -1;
    }
    
    /* Notificaciones */
    .notificacion {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      z-index: 1001;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      transform: translateX(150%);
      transition: transform 0.3s ease, opacity 0.3s ease;
      opacity: 0;
    }
    
    .notificacion.show {
      transform: translateX(0);
      opacity: 1;
    }
    
    .notificacion.hide {
      transform: translateX(150%);
      opacity: 0;
    }
    
    .notificacion-info {
      background: rgba(41, 128, 185, 0.9);
      border-left: 4px solid #2980b9;
    }
    
    .notificacion-success {
      background: rgba(39, 174, 96, 0.9);
      border-left: 4px solid #27ae60;
    }
    
    .notificacion-warning {
      background: rgba(241, 196, 15, 0.9);
      border-left: 4px solid #f1c40f;
    }
    
    .notificacion-error {
      background: rgba(231, 76, 60, 0.9);
      border-left: 4px solid #e74c3c;
    }
    
    .notificacion i {
      font-size: 1.2rem;
    }
    
    /* Animación de carga para verificación */
    .verificando {
      position: relative;
      pointer-events: none;
    }
    
    .verificando::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin-top: -10px;
      margin-left: -10px;
      border-radius: 50%;
      border: 2px solid rgba(0, 0, 0, 0.1);
      border-top-color: var(--dark);
      animation: spin 0.8s linear infinite;
    }

    /* Estilo definitivo - Negro/Dorado Premium */
    #btn-cerrar-sesion {
      box-sizing: border-box !important;
      font-family: 'Montserrat', sans-serif !important;
      text-transform: none !important;
      letter-spacing: normal !important;
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(10, 10, 10, 0.95); /* Negro sólido con ligera transparencia */
      color: #D4AF37 !important; /* Dorado */
      border: 1px solid #D4AF37 !important;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 500;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(2px);
      text-decoration: none !important;
    }

    #btn-cerrar-sesion::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.2), transparent);
      transition: 0.5s;
      z-index: -1;
    } 

    #btn-cerrar-sesion:hover {
      background: #D4AF37 !important; /* Fondo dorado al hover */
      color: #0a0a0a !important; /* Texto negro al hover */
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
    }

    #btn-cerrar-sesion i {
      font-size: 0.9rem;
    }

    /* Estilos para el tema oscuro/claro */
    body.light-mode {
      --dark: #f8f8f8;
      --darker: #e0e0e0;
      --light: #121212;
      background-color: var(--dark);
      background-image: none;
    }

    .light-mode .glass-panel {
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid var(--gold);
    }

    .light-mode .tabla-citas {
      background-color: rgba(255, 255, 255, 0.5);
    }

    .light-mode .tabla-citas th {
      background-color: rgba(212, 175, 55, 0.3);
    }

    .light-mode .tabla-citas td {
      color: #333 !important;
    }

    .light-mode .tabla-citas td:first-child {
      color: #222 !important;
    }

    .light-mode .detalle-item p {
      color: #333 !important;
    }

    .theme-switcher {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(10, 10, 10, 0.95);
      border: 1px solid var(--gold);
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .theme-switcher:hover {
      background: var(--gold);
    }

    .theme-switcher i {
      color: var(--gold);
      font-size: 1.2rem;
    }

    .light-mode .theme-switcher i {
      color: var(--dark);
    }

    .light-mode .theme-switcher {
      background: rgba(255, 255, 255, 0.95);
    }

    .light-mode .theme-switcher:hover i {
      color: var(--dark);
    }

    /* Estilos para el calendario */
    #calendar {
      margin-bottom: 2rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      border: 1px solid rgba(212, 175, 55, 0.3);
      padding: 1rem;
    }

    .light-mode #calendar {
      background: rgba(255, 255, 255, 0.5);
    }

    .fc-toolbar-title {
      color: var(--gold) !important;
    }

    .fc-col-header-cell-cushion {
      color: var(--gold) !important;
    }

    .fc-daygrid-day-number {
      color: #ff4d4d !important;
    }

    .light-mode .fc-daygrid-day-number {
      color: #333 !important;
    }

    .fc-event {
      background-color: rgba(212, 175, 55, 0.3) !important;
      border-color: var(--gold) !important;
      color: var(--light) !important;
    }

    /* Estilos para el sistema de turnos */
    .turnos-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 2rem;
    }

    .turno-card {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 10px;
      padding: 1rem;
      flex: 1;
      min-width: 200px;
      transition: all 0.3s;
    }

    .turno-card.active {
      border-color: var(--gold);
      box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
    }

    .turno-card h3 {
      color: var(--gold);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .turno-card p {
      color: var(--light);
      margin-bottom: 0.5rem;
    }

    .turno-card .badge {
      background: var(--gold);
      color: var(--dark);
      padding: 3px 8px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
    }

    /* Estilos para perfiles de barberos */
    .barberos-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 2rem;
    }

    .barbero-card {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 10px;
      padding: 1.5rem;
      transition: all 0.3s;
    }

    .barbero-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .barbero-header {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
    }

    .barbero-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--gold);
      margin-right: 1rem;
    }

    .barbero-info h3 {
      color: var(--gold);
      margin-bottom: 0.2rem;
    }

    .barbero-info p {
      color: var(--light);
      opacity: 0.8;
      font-size: 0.9rem;
    }

    .barbero-horarios {
      margin-top: 1rem;
    }

    .barbero-horarios h4 {
      color: var(--gold);
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .horario-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.3rem;
      font-size: 0.9rem;
      color: var(--light);
    }

    .barbero-especialidades {
      margin-top: 1rem;
    }

    .especialidad-tag {
      display: inline-block;
      background: rgba(212, 175, 55, 0.2);
      color: var(--gold);
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      margin-right: 5px;
      margin-bottom: 5px;
    }

    /* Estilos para el historial de clientes */
    .historial-container {
      margin-bottom: 2rem;
    }

    .historial-cliente {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }

    .historial-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .historial-header h3 {
      color: var(--gold);
    }

    .historial-item {
      display: flex;
      justify-content: space-between;
      padding: 0.8rem 0;
      border-bottom: 1px solid rgba(212, 175, 55, 0.1);
    }

    .historial-item:last-child {
      border-bottom: none;
    }

    .historial-servicio {
      font-weight: bold;
      color: var(--light);
    }

    .historial-fecha {
      color: var(--light);
      opacity: 0.8;
    }

    /* Estilos para el sistema de valoraciones */
    .valoracion-container {
      margin-bottom: 2rem;
    }

    .valoracion-card {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }

    .valoracion-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .valoracion-cliente {
      color: var(--gold);
      font-weight: bold;
    }

    .valoracion-estrellas {
      color: var(--gold);
    }

    .valoracion-comentario {
      color: var(--light);
      font-style: italic;
      margin-top: 0.5rem;
    }

    /* Estilos para la integración de redes sociales */
    .redes-container {
      margin-bottom: 2rem;
    }

    .instagram-feed {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .instagram-post {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid rgba(212, 175, 55, 0.3);
    }

    .instagram-post img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }

    .instagram-post:hover img {
      transform: scale(1.05);
    }

    .instagram-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px;
      color: white;
      font-size: 0.8rem;
    }

    .compartir-redes {
      display: flex;
      gap: 10px;
      margin-top: 1rem;
    }

    .btn-compartir {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(212, 175, 55, 0.3);
      color: var(--light);
      padding: 8px 15px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-compartir:hover {
      background: rgba(212, 175, 55, 0.2);
    }

    /* Pestañas para organizar las secciones */
    .tabs {
      display: flex;
      border-bottom: 1px solid rgba(212, 175, 55, 0.3);
      margin-bottom: 1.5rem;
    }

    .tab {
      padding: 10px 20px;
      cursor: pointer;
      color: var(--light);
      opacity: 0.7;
      transition: all 0.3s;
      border-bottom: 3px solid transparent;
    }

    .tab.active {
      opacity: 1;
      color: var(--gold);
      border-bottom: 3px solid var(--gold);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      
      .glass-panel {
        padding: 1.5rem;
      }
      
      .panel-control {
        flex-direction: column;
      }
      
      .filters {
        width: 100%;
      }
      
      select {
        width: 100%;
      }
      
      .btn-export {
        width: 100%;
      }
      
      .tabla-citas {
        font-size: 0.9rem;
      }
      
      .tabla-citas th, 
      .tabla-citas td {
        padding: 10px 8px;
      }

      /* Asegurar que no se solape con otros elementos */
      header {
        margin-top: 40px !important;
      }

      .barberos-container {
        grid-template-columns: 1fr;
      }

      .instagram-feed {
        grid-template-columns: repeat(2, 1fr);
      }

      .tabs {
        overflow-x: auto;
        white-space: nowrap;
      }

      .tab {
        padding: 10px 15px;
      }

      header h1 {
        margin-top: 30px !important;
      }
    }

    @media (max-width: 480px) {
      .instagram-feed {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="gold-glow"></div>

  <!-- ******************** HTML ******************** -->
  
  <div class="container">
    <div class="glass-panel">
      <header>
        <h1><i class="fas fa-cut"></i> Panel de Citas</h1>
        <p>Barbería Elite - Gestión Profesional</p>
      </header>
      
      <main>
        <!-- Pestañas para navegar entre secciones -->
        <div class="tabs">
          <div class="tab active" data-tab="citas">Citas</div>
          <div class="tab" data-tab="calendario">Calendario</div>
          <div class="tab" data-tab="turnos">Turnos</div>
          <div class="tab" data-tab="barberos">Barberos</div>
          <div class="tab" data-tab="historial">Historial</div>
          <div class="tab" data-tab="valoraciones">Valoraciones</div>
          <div class="tab" data-tab="redes">Redes Sociales</div>
        </div>

        <!-- Contenido de la pestaña Citas -->
        <div id="citas-tab" class="tab-content active">
          <div class="panel-control">
            <div class="search-container">
              <i class="fas fa-search"></i>
              <input type="text" id="buscador" placeholder="Buscar por nombre...">
            </div>
            
            <div class="filters">
              <select id="filtro-estado">
                <option value="todas">Todas las citas</option>
                <option value="pendiente">Pendientes</option>
                <option value="completado">Completadas</option>
                <option value="cancelado">Canceladas</option>
              </select>
              
              <select id="filtro-barbero">
                <option value="todos">Todos los barberos</option>
                <option value="Juan">Juan</option>
                <option value="Carlos">Carlos</option>
                <option value="Pedro">Pedro</option>
              </select>
              
              <button id="btn-exportar" class="btn-export">
                <i class="fas fa-file-export"></i> Exportar
              </button>
            </div>
          </div>
          
          <div id="citasContainer">
            <div class="loading">
              <i class="fas fa-spinner"></i>
              <p>Cargando citas...</p>
            </div>
          </div>
          
          <div class="stats-container">
            <div class="stat-card">
              <h3>Total Citas</h3>
              <p id="total-citas">0</p>
            </div>
            <div class="stat-card">
              <h3>Pendientes</h3>
              <p id="pendientes-citas">0</p>
            </div>
            <div class="stat-card">
              <h3>Completadas</h3>
              <p id="completadas-citas">0</p>
            </div>
          </div>
        </div>

        <!-- Contenido de la pestaña Calendario -->
        <div id="calendario-tab" class="tab-content">
          <div id="calendar"></div>
        </div>

        <!-- Contenido de la pestaña Turnos -->
        <div id="turnos-tab" class="tab-content">
          <h2><i class="fas fa-clock"></i> Sistema de Turnos</h2>
          <p>Visualiza y gestiona los turnos de los barberos</p>
          
          <div class="turnos-container">
            <div class="turno-card active">
              <h3>Turno Actual <span class="badge">En curso</span></h3>
              <p><strong>Barbero:</strong> Juan Pérez</p>
              <p><strong>Cliente:</strong> Roberto García</p>
              <p><strong>Hora:</strong> 10:00 - 10:45</p>
              <p><strong>Servicio:</strong> Corte y barba</p>
            </div>
            
            <div class="turno-card">
              <h3>Siguiente Turno</h3>
              <p><strong>Barbero:</strong> Carlos López</p>
              <p><strong>Cliente:</strong> Miguel Sánchez</p>
              <p><strong>Hora:</strong> 10:30 - 11:15</p>
              <p><strong>Servicio:</strong> Corte clásico</p>
            </div>
            
            <div class="turno-card">
              <h3>Próximos Turnos</h3>
              <p><strong>Barbero:</strong> Pedro Gómez</p>
              <p><strong>Cliente:</strong> Luis Martínez</p>
              <p><strong>Hora:</strong> 11:00 - 11:45</p>
              <p><strong>Servicio:</strong> Corte moderno</p>
            </div>
          </div>
        </div>

        <!-- Contenido de la pestaña Barberos -->
        <div id="barberos-tab" class="tab-content">
          <h2><i class="fas fa-user-tie"></i> Perfiles de Barberos</h2>
          <p>Gestiona la información de los barberos</p>
          
          <div class="barberos-container">
            <div class="barbero-card">
              <div class="barbero-header">
                <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Juan Pérez" class="barbero-avatar">
                <div class="barbero-info">
                  <h3>Juan Pérez</h3>
                  <p>Barbero principal</p>
                </div>
              </div>
              
              <div class="barbero-horarios">
                <h4><i class="fas fa-calendar-alt"></i> Horario</h4>
                <div class="horario-item">
                  <span>Lunes - Viernes</span>
                  <span>9:00 - 18:00</span>
                </div>
                <div class="horario-item">
                  <span>Sábado</span>
                  <span>10:00 - 15:00</span>
                </div>
                <div class="horario-item">
                  <span>Domingo</span>
                  <span>Cerrado</span>
                </div>
              </div>
              
              <div class="barbero-especialidades">
                <h4><i class="fas fa-star"></i> Especialidades</h4>
                <span class="especialidad-tag">Corte clásico</span>
                <span class="especialidad-tag">Barba</span>
                <span class="especialidad-tag">Tinte</span>
              </div>
            </div>
            
            <div class="barbero-card">
              <div class="barbero-header">
                <img src="https://randomuser.me/api/portraits/men/44.jpg" alt="Carlos López" class="barbero-avatar">
                <div class="barbero-info">
                  <h3>Carlos López</h3>
                  <p>Especialista en estilos modernos</p>
                </div>
              </div>
              
              <div class="barbero-horarios">
                <h4><i class="fas fa-calendar-alt"></i> Horario</h4>
                <div class="horario-item">
                  <span>Martes - Sábado</span>
                  <span>11:00 - 20:00</span>
                </div>
                <div class="horario-item">
                  <span>Domingo - Lunes</span>
                  <span>Cerrado</span>
                </div>
              </div>
              
              <div class="barbero-especialidades">
                <h4><i class="fas fa-star"></i> Especialidades</h4>
                <span class="especialidad-tag">Corte moderno</span>
                <span class="especialidad-tag">Diseños</span>
                <span class="especialidad-tag">Fade</span>
              </div>
            </div>
            
            <div class="barbero-card">
              <div class="barbero-header">
                <img src="https://randomuser.me/api/portraits/men/67.jpg" alt="Pedro Gómez" class="barbero-avatar">
                <div class="barbero-info">
                  <h3>Pedro Gómez</h3>
                  <p>Experto en barbas</p>
                </div>
              </div>
              
              <div class="barbero-horarios">
                <h4><i class="fas fa-calendar-alt"></i> Horario</h4>
                <div class="horario-item">
                  <span>Lunes - Viernes</span>
                  <span>10:00 - 19:00</span>
                </div>
                <div class="horario-item">
                  <span>Sábado</span>
                  <span>9:00 - 14:00</span>
                </div>
                <div class="horario-item">
                  <span>Domingo</span>
                  <span>Cerrado</span>
                </div>
              </div>
              
              <div class="barbero-especialidades">
                <h4><i class="fas fa-star"></i> Especialidades</h4>
                <span class="especialidad-tag">Arreglo de barba</span>
                <span class="especialidad-tag">Afeitado clásico</span>
                <span class="especialidad-tag">Tratamientos</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Contenido de la pestaña Historial -->
        <div id="historial-tab" class="tab-content">
          <h2><i class="fas fa-history"></i> Historial de Clientes</h2>
          <p>Registro de servicios realizados a cada cliente</p>
          
          <div class="historial-container">
            <div class="historial-cliente">
              <div class="historial-header">
                <h3>Roberto García</h3>
                <p>Cliente desde: 15/03/2023</p>
              </div>
              
              <div class="historial-item">
                <span class="historial-servicio">Corte clásico + Barba</span>
                <span class="historial-fecha">10/05/2024</span>
              </div>
              
              <div class="historial-item">
                <span class="historial-servicio">Corte moderno</span>
                <span class="historial-fecha">24/04/2024</span>
              </div>
              
              <div class="historial-item">
                <span class="historial-servicio">Afeitado clásico</span>
                <span class="historial-fecha">05/04/2024</span>
              </div>
            </div>
            
            <div class="historial-cliente">
              <div class="historial-header">
                <h3>Miguel Sánchez</h3>
                <p>Cliente desde: 22/01/2024</p>
              </div>
              
              <div class="historial-item">
                <span class="historial-servicio">Corte fade + Diseño</span>
                <span class="historial-fecha">12/05/2024</span>
              </div>
              
              <div class="historial-item">
                <span class="historial-servicio">Tinte de cabello</span>
                <span class="historial-fecha">28/03/2024</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Contenido de la pestaña Valoraciones -->
        <div id="valoraciones-tab" class="tab-content">
          <h2><i class="fas fa-star"></i> Valoraciones de Clientes</h2>
          <p>Opiniones y calificaciones de los servicios</p>
          
          <div class="valoracion-container">
            <div class="valoracion-card">
              <div class="valoracion-header">
                <span class="valoracion-cliente">Roberto García</span>
                <span class="valoracion-estrellas">
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                </span>
              </div>
              <p class="valoracion-comentario">"Excelente servicio, muy profesional y atención personalizada. Volveré sin duda."</p>
              <p class="valoracion-fecha">15/05/2024 - Corte clásico</p>
            </div>
            
            <div class="valoracion-card">
              <div class="valoracion-header">
                <span class="valoracion-cliente">Miguel Sánchez</span>
                <span class="valoracion-estrellas">
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="far fa-star"></i>
                </span>
              </div>
              <p class="valoracion-comentario">"Muy buen corte, aunque la espera fue un poco larga. Recomendado."</p>
              <p class="valoracion-fecha">12/05/2024 - Corte fade</p>
            </div>
            
            <div class="valoracion-card">
              <div class="valoracion-header">
                <span class="valoracion-cliente">Luis Martínez</span>
                <span class="valoracion-estrellas">
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star-half-alt"></i>
                </span>
              </div>
              <p class="valoracion-comentario">"Carlos es un artista con las tijeras. Me encantó el diseño que me hizo."</p>
              <p class="valoracion-fecha">08/05/2024 - Corte moderno</p>
            </div>
          </div>
        </div>

        <!-- Contenido de la pestaña Redes Sociales -->
        <div id="redes-tab" class="tab-content">
          <h2><i class="fas fa-share-alt"></i> Integración con Redes Sociales</h2>
          <p>Conecta con tus clientes a través de las redes</p>
          
          <div class="redes-container">
            <h3><i class="fab fa-instagram"></i> Instagram Feed</h3>
            <div class="instagram-feed">
              <div class="instagram-post">
                <img src="https://source.unsplash.com/random/300x300/?barber" alt="Publicación Instagram">
                <div class="instagram-overlay">
                  <p>Nuevos estilos de verano</p>
                </div>
              </div>
              <div class="instagram-post">
                <img src="https://source.unsplash.com/random/300x300/?haircut" alt="Publicación Instagram">
                <div class="instagram-overlay">
                  <p>Trabajo realizado hoy</p>
                </div>
              </div>
              <div class="instagram-post">
                <img src="https://source.unsplash.com/random/300x300/?beard" alt="Publicación Instagram">
                <div class="instagram-overlay">
                  <p>Tratamientos para barba</p>
                </div>
              </div>
            </div>
            
            <h3 style="margin-top: 2rem;"><i class="fas fa-share"></i> Compartir en Redes</h3>
            <div class="compartir-redes">
              <button class="btn-compartir">
                <i class="fab fa-facebook-f"></i> Facebook
              </button>
              <button class="btn-compartir">
                <i class="fab fa-instagram"></i> Instagram
              </button>
              <button class="btn-compartir">
                <i class="fab fa-whatsapp"></i> WhatsApp
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>
    
    <footer>
      <a href="index.html" class="btn-volver">
        <i class="fas fa-arrow-left"></i> Volver al inicio
      </a>
      <p>© 2025 Barbería Elite - Sistema de gestión de citas</p>
    </footer>
  </div>

  <!-- Modal para detalles -->
  <div id="modal-detalles" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h2>Detalles de Cita</h2>
      <div id="modal-body"></div>
    </div>
  </div>

  <!-- Modal de verificación -->
  <div id="modal-verificacion" class="modal-verificacion" style="display: none;">
    <div class="contenido-verificacion">
      <h2>Acceso Restringido</h2>
      <p>Ingrese la contraseña de barbero:</p>
      <input type="password" id="input-password" placeholder="Contraseña">
      <button id="btn-verificar" class="btn-verificar">Verificar</button>
      <p id="mensaje-error-verificacion" class="mensaje-error-verificacion">Contraseña incorrecta</p>
    </div>
  </div>

  <!-- Botón para cambiar tema oscuro/claro -->
  <div class="theme-switcher" title="Cambiar tema">
    <i class="fas fa-moon"></i>
  </div>

  <!-- Scripts en el orden CORRECTO -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/es.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>
  <script src="scripts.js"></script>

  <!-- ******************** JAVASCRIPT ******************** -->
  <script>
    // Variables globales
    let todasLasCitas = [];
    let modalAbierto = false;
    let canalCitas = null;
    let calendar = null;

    // Función para mostrar notificaciones
    function mostrarNotificacion(mensaje, tipo = 'info') {
      const notificacion = document.createElement('div');
      notificacion.className = `notificacion notificacion-${tipo}`;
      notificacion.innerHTML = `
        <i class="fas fa-${tipo === 'info' ? 'info-circle' : 
                          tipo === 'success' ? 'check-circle' : 
                          tipo === 'warning' ? 'exclamation-triangle' : 
                          'times-circle'}"></i>
        <p>${mensaje}</p>
      `;
      document.body.appendChild(notificacion);
      
      // Mostrar notificación
      setTimeout(() => {
        notificacion.classList.add('show');
      }, 10);
      
      // Ocultar después de 3 segundos
      setTimeout(() => {
        notificacion.classList.remove('show');
        notificacion.classList.add('hide');
        
        // Eliminar después de la animación
        setTimeout(() => notificacion.remove(), 300);
      }, 3000);
    }

    // Verificación de seguridad para barberos
    async function verificarAccesoBarbero() {
      // Contraseña simple (puedes cambiarla)
      const CONTRASENA = "barbero123";
      // Verificar si ya está autenticado
      const yaAutenticado = sessionStorage.getItem('barberoAutenticado');
      if (yaAutenticado === 'true') {
        return true;
      }
      
      // Mostrar modal de verificación
      const modal = document.getElementById('modal-verificacion');
      modal.style.display = 'flex';
      
      return new Promise((resolve) => {
        const verificar = () => {
          const inputPassword = document.getElementById('input-password').value;
          if (!inputPassword) return;
          
          // Mostrar estado de carga
          const btnVerificar = document.getElementById('btn-verificar');
          btnVerificar.classList.add('verificando');
          btnVerificar.disabled = true;
          
          // Simular verificación con retraso (para mejor UX)
          setTimeout(() => {
            if (inputPassword === CONTRASENA) {
              sessionStorage.setItem('barberoAutenticado', 'true');
              modal.style.display = 'none';
              mostrarNotificacion('Acceso concedido', 'success');
              resolve(true);
            } else {
              document.getElementById('mensaje-error-verificacion').style.display = 'block';
              mostrarNotificacion('Contraseña incorrecta', 'error');
              btnVerificar.classList.remove('verificando');
              btnVerificar.disabled = false;
              resolve(false);
            }
          }, 800);
        };
        
        // Configurar eventos
        document.getElementById('btn-verificar').onclick = verificar;
        document.getElementById('input-password').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            verificar();
          }
        });
      });
    }

    // Función para mostrar botón de cerrar sesión
    function mostrarBotonCerrarSesion() {
      // Eliminar botón existente si existe
      const botonExistente = document.getElementById('btn-cerrar-sesion');
      if (botonExistente) botonExistente.remove();
  
      // Crear nuevo botón
      const botonCerrar = document.createElement('button');
      botonCerrar.id = 'btn-cerrar-sesion';
      botonCerrar.innerHTML = `
        <i class="fas fa-sign-out-alt"></i>
        <span>Salir del panel</span>
      `;

      // Estilos en línea como garantía
      botonCerrar.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(10, 10, 10, 0.95);
        color: #D4AF37;
        border: 1px solid #D4AF37;
        padding: 8px 15px;
        border-radius: 4px;
        z-index: 1000;
        font-family: inherit;
        display: flex;
        align-items: center;
        gap: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
      `;
  
      botonCerrar.addEventListener('mouseenter', () => {
        botonCerrar.style.background = '#D4AF37';
        botonCerrar.style.color = '#0a0a0a';
      });
  
      botonCerrar.addEventListener('mouseleave', () => {
        botonCerrar.style.background = 'rgba(10, 10, 10, 0.95)';
        botonCerrar.style.color = '#D4AF37';
      });
  
      botonCerrar.addEventListener('click', () => {
        sessionStorage.removeItem('barberoAutenticado');
        mostrarNotificacion('Sesión cerrada correctamente', 'success');
        setTimeout(() => window.location.reload(), 1000);
      });
  
      document.body.appendChild(botonCerrar);
    }
     
    // Cargar citas desde Supabase
    async function cargarCitas() {
      const contenedor = document.getElementById('citasContainer');
      if (!contenedor) return;

      try {
        contenedor.innerHTML = `
          <div class="loading">
            <i class="fas fa-spinner"></i>
            <p>Cargando citas...</p>
          </div>
        `;

        const { data: citas, error } = await supabase
          .from('citas')
          .select('*')
          .order('fecha', { ascending: true })
          .order('hora', { ascending: true });

        if (error) throw error;

        todasLasCitas = citas || [];
        mostrarCitas(todasLasCitas);
        actualizarEstadisticas(todasLasCitas);
        actualizarCalendario(todasLasCitas);
        
      } catch (error) {
        console.error('Error al cargar citas:', error);
        contenedor.innerHTML = `
          <div class="mensaje-error">
            <p>Error al cargar citas. Por favor intente nuevamente.</p>
            <button onclick="window.location.reload()" class="btn-reintentar">
              <i class="fas fa-sync-alt"></i> Reintentar
            </button>
          </div>
        `;
      }
    }

    // Mostrar citas en la tabla
    function mostrarCitas(citas) {
      const contenedor = document.getElementById('citasContainer');
      if (!contenedor) return;

      if (!citas || citas.length === 0) {
        contenedor.innerHTML = '<p class="no-citas">No hay citas agendadas actualmente</p>';
        return;
      }

      let html = `
        <div class="table-responsive">
          <table class="tabla-citas">
            <thead>
              <tr>
                <th>Cliente</th>
                <th>Contacto</th>
                <th>Fecha</th>
                <th>Hora</th>
                <th>Servicio</th>
                <th>Barbero</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
      `;

      citas.forEach(cita => {
        const fechaFormateada = new Date(cita.fecha).toLocaleDateString('es-ES');
        const horaFormateada = cita.hora.substring(0, 5);
        
        html += `
          <tr>
            <td>${cita.nombre}</td>
            <td>${cita.telefono}</td>
            <td>${fechaFormateada}</td>
            <td>${horaFormateada}</td>
            <td>${cita.servicio}</td>
            <td>${cita.barbero}</td>
            <td class="estado-cita" data-estado="${cita.estado}">
              ${cita.estado}
            </td>
            <td class="acciones">
              <button class="btn-accion btn-completar" data-id="${cita.id}" title="Completar">
                <i class="fas fa-check"></i>
              </button>
              <button class="btn-accion btn-cancelar" data-id="${cita.id}" title="Cancelar">
                <i class="fas fa-times"></i>
              </button>
              <button class="btn-accion btn-detalles" data-id="${cita.id}" title="Detalles">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn-accion btn-eliminar" data-id="${cita.id}" title="Eliminar">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      });

      html += `</tbody></table></div>`;
      contenedor.innerHTML = html;
      agregarEventosBotones();
    }

    // Agregar eventos a los botones de acción
    function agregarEventosBotones() {
      document.querySelectorAll('.btn-completar').forEach(btn => {
        btn.addEventListener('click', () => cambiarEstadoCita(btn.dataset.id, 'completado'));
      });
      
      document.querySelectorAll('.btn-cancelar').forEach(btn => {
        btn.addEventListener('click', () => cambiarEstadoCita(btn.dataset.id, 'cancelado'));
      });
      
      document.querySelectorAll('.btn-detalles').forEach(btn => {
        btn.addEventListener('click', () => mostrarDetallesCita(btn.dataset.id));
      });
      
      document.querySelectorAll('.btn-eliminar').forEach(btn => {
        btn.addEventListener('click', () => eliminarCita(btn.dataset.id));
      });
    }

    // Cambiar estado de una cita
    async function cambiarEstadoCita(id, nuevoEstado) {
      try {
        const { error } = await supabase
          .from('citas')
          .update({ estado: nuevoEstado })
          .eq('id', id);
        
        if (error) throw error;
        
        mostrarNotificacion(`Cita marcada como ${nuevoEstado}`, 'success');
        await cargarCitas();
        
      } catch (error) {
        console.error('Error al actualizar cita:', error);
        mostrarNotificacion('Error al actualizar el estado de la cita', 'error');
      }
    }
    
    // Eliminar una cita
    async function eliminarCita(id) {
      if (!confirm('¿Estás seguro de que deseas eliminar esta cita?')) return;
      
      try {
        const { error } = await supabase
          .from('citas')
          .delete()
          .eq('id', id);
        
        if (error) throw error;
        
        mostrarNotificacion('Cita eliminada correctamente', 'success');
        await cargarCitas();
        
      } catch (error) {
        console.error('Error al eliminar cita:', error);
        mostrarNotificacion('Error al eliminar la cita', 'error');
      }
    }

    // Mostrar detalles de cita en modal
    async function mostrarDetallesCita(id) {
      if (modalAbierto) return;
      modalAbierto = true;
      
      const modal = document.getElementById('modal-detalles');
      const modalBody = document.getElementById('modal-body');
      
      try {
        const { data: cita, error } = await supabase
          .from('citas')
          .select('*')
          .eq('id', id)
          .single();
        
        if (error) throw error;
        
        const fechaFormateada = new Date(cita.fecha).toLocaleDateString('es-ES', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        
        modalBody.innerHTML = `
          <div class="detalle-item">
            <h3>Cliente:</h3>
            <p>${cita.nombre}</p>
          </div>
          <div class="detalle-item">
            <h3>Teléfono:</h3>
            <p>${cita.telefono}</p>
          </div>
          <div class="detalle-item">
            <h3>Fecha:</h3>
            <p>${fechaFormateada}</p>
          </div>
          <div class="detalle-item">
            <h3>Hora:</h3>
            <p>${cita.hora.substring(0, 5)}</p>
          </div>
          <div class="detalle-item">
            <h3>Servicio:</h3>
            <p>${cita.servicio}</p>
          </div>
          <div class="detalle-item">
            <h3>Barbero:</h3>
            <p>${cita.barbero}</p>
          </div>
          <div class="detalle-item">
            <h3>Estado:</h3>
            <p class="estado-cita" data-estado="${cita.estado}">${cita.estado}</p>
          </div>
          <button class="btn-cerrar-detalles" style="margin-top: 20px; padding: 10px; background: var(--gold); color: var(--dark); border: none; border-radius: 5px; cursor: pointer;">
            Cerrar detalles
          </button>
        `;
        
        modal.style.display = 'flex';
        
        // Configurar cierre del modal
        document.querySelector('.btn-cerrar-detalles').addEventListener('click', cerrarModal);
        document.querySelector('.close-modal').addEventListener('click', cerrarModal);
        
      } catch (error) {
        console.error('Error al cargar detalles:', error);
        modalBody.innerHTML = '<p class="mensaje-error">Error al cargar los detalles de la cita</p>';
        modal.style.display = 'flex';
      }
    }

    function cerrarModal() {
      const modal = document.getElementById('modal-detalles');
      modal.style.display = 'none';
      modalAbierto = false;
    }
	
	  // Filtrar citas
    function filtrarCitas() {
      const textoBusqueda = document.getElementById('buscador')?.value.toLowerCase() || '';
      const filtroEstado = document.getElementById('filtro-estado')?.value || 'todas';
      const filtroBarbero = document.getElementById('filtro-barbero')?.value || 'todos';

      let citasFiltradas = todasLasCitas.filter(cita => {
        const coincideNombre = cita.nombre.toLowerCase().includes(textoBusqueda);
        const coincideTelefono = cita.telefono.includes(textoBusqueda);
        const coincideEstado = filtroEstado === 'todas' || cita.estado === filtroEstado;
        const coincideBarbero = filtroBarbero === 'todos' || cita.barbero === filtroBarbero;
        
        return (coincideNombre || coincideTelefono) && coincideEstado && coincideBarbero;
      });

      mostrarCitas(citasFiltradas);
    }

    // Actualizar estadísticas
    function actualizarEstadisticas(citas) {
      const totalCitas = document.getElementById('total-citas');
      const pendientesCitas = document.getElementById('pendientes-citas');
      const completadasCitas = document.getElementById('completadas-citas');
      
      if (totalCitas) totalCitas.textContent = citas.length;
      if (pendientesCitas) pendientesCitas.textContent = citas.filter(c => c.estado === 'pendiente').length;
      if (completadasCitas) completadasCitas.textContent = citas.filter(c => c.estado === 'completado').length;
    }

    // Exportar citas a CSV
    function exportarCitas() {
      if (todasLasCitas.length === 0) {
        mostrarNotificacion('No hay citas para exportar', 'warning');
        return;
      }
      
      let csv = 'Nombre,Telefono,Fecha,Hora,Servicio,Barbero,Estado\n';
      
      todasLasCitas.forEach(cita => {
        csv += `"${cita.nombre}","${cita.telefono}","${cita.fecha}","${cita.hora}","${cita.servicio}","${cita.barbero}","${cita.estado}"\n`;
      });
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.setAttribute('download', `citas_barberia_${new Date().toISOString().split('T')[0]}.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      mostrarNotificacion('Exportación completada con éxito', 'success');
    }

    // Conectar a websockets para cambios en tiempo real
    function conectarWebsockets() {
      if (canalCitas) {
        supabase.removeChannel(canalCitas);
      }

      canalCitas = supabase
        .channel('schema-db-changes')
        .on(
          'postgres_changes',
          {
            event: '*',
            schema: 'public',
            table: 'citas'
          },
          (payload) => {
            console.log('Cambio recibido:', payload);
            cargarCitas();
          }
        )
        .subscribe((status, err) => {
          if (status === 'SUBSCRIBED') {
            console.log('Canal suscrito correctamente');
          }
          if (err) {
            console.error('Error en suscripción:', err);
          }
        });
    }

    // Inicializar calendario
    function inicializarCalendario() {
      const calendarEl = document.getElementById('calendar');
      if (!calendarEl) return;

      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'es',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        buttonText: {
          today: 'Hoy',
          month: 'Mes',
          week: 'Semana',
          day: 'Día'
        },
        events: [],
        eventClick: function(info) {
          mostrarDetallesCita(info.event.id);
        }
      });

      calendar.render();
    }

    // Actualizar calendario con las citas
    function actualizarCalendario(citas) {
      if (!calendar) return;

      // Limpiar eventos existentes
      calendar.getEvents().forEach(event => event.remove());

      // Agregar nuevas citas como eventos
      citas.forEach(cita => {
        const fechaHora = new Date(cita.fecha);
        const [horas, minutos] = cita.hora.split(':');
        fechaHora.setHours(horas, minutos);
        
        const fechaHoraFin = new Date(fechaHora);
        fechaHoraFin.setMinutes(fechaHoraFin.getMinutes() + 30); // Asumimos 30 minutos por cita

        let colorEvento;
        switch(cita.estado) {
          case 'completado':
            colorEvento = '#27ae60';
            break;
          case 'cancelado':
            colorEvento = '#e74c3c';
            break;
          default:
            colorEvento = '#f39c12';
        }

        calendar.addEvent({
          id: cita.id,
          title: `${cita.nombre} - ${cita.servicio}`,
          start: fechaHora,
          end: fechaHoraFin,
          color: colorEvento,
          extendedProps: {
            barbero: cita.barbero,
            telefono: cita.telefono
          }
        });
      });
    }

    // Manejar cambio de tema oscuro/claro
    function configurarTema() {
      const themeSwitcher = document.querySelector('.theme-switcher');
      if (!themeSwitcher) return;

      // Verificar preferencia del usuario
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (prefersDark) {
        document.body.classList.remove('light-mode');
      } else {
        document.body.classList.add('light-mode');
      }

      // Alternar tema al hacer clic
      themeSwitcher.addEventListener('click', () => {
        document.body.classList.toggle('light-mode');
        
        // Cambiar icono
        const icon = themeSwitcher.querySelector('i');
        if (document.body.classList.contains('light-mode')) {
          icon.classList.remove('fa-moon');
          icon.classList.add('fa-sun');
        } else {
          icon.classList.remove('fa-sun');
          icon.classList.add('fa-moon');
        }
      });
    }

    // Configurar pestañas
    function configurarPestanas() {
      const tabs = document.querySelectorAll('.tab');
      const tabContents = document.querySelectorAll('.tab-content');

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // Remover clase active de todas las pestañas y contenidos
          tabs.forEach(t => t.classList.remove('active'));
          tabContents.forEach(c => c.classList.remove('active'));
          
          // Agregar clase active a la pestaña clickeada
          tab.classList.add('active');
          
          // Mostrar el contenido correspondiente
          const tabId = tab.getAttribute('data-tab');
          document.getElementById(`${tabId}-tab`).classList.add('active');
        });
      });
    }

    // Configurar sistema de turnos
    function configurarTurnos() {
      // Simular notificación de turno cada 5 minutos (solo para demostración)
      setInterval(() => {
        const turnos = document.querySelectorAll('.turno-card');
        turnos.forEach((turno, index) => {
          if (index === 0) return; // Saltar el turno actual
          
          if (Math.random() > 0.7) { // 30% de probabilidad de notificación
            turno.classList.add('active');
            mostrarNotificacion(`Próximo turno: ${turno.querySelector('h3').textContent}`, 'info');
            
            setTimeout(() => {
              turno.classList.remove('active');
            }, 5000);
          }
        });
      }, 300000); // 5 minutos
    }

    // Configurar valoraciones
    function configurarValoraciones() {
      // Inicializar plugin de estrellas (solo para demostración)
      $('.valoracion-estrellas').each(function() {
        const rating = $(this).find('i.fa-star').length;
        $(this).rateYo({
          rating: rating,
          readOnly: true,
          starWidth: "20px",
          normalFill: "#ccc",
          ratedFill: "#D4AF37"
        });
      });
    }

    // Configurar integración con redes sociales
    function configurarRedesSociales() {
      // Simular acción de compartir
      document.querySelectorAll('.btn-compartir').forEach(btn => {
        btn.addEventListener('click', () => {
          let redSocial = '';
          if (btn.querySelector('.fa-facebook-f')) redSocial = 'Facebook';
          if (btn.querySelector('.fa-instagram')) redSocial = 'Instagram';
          if (btn.querySelector('.fa-whatsapp')) redSocial = 'WhatsApp';
          
          mostrarNotificacion(`Compartiendo en ${redSocial}...`, 'info');
        });
      });
    }

    // Enviar recordatorios automáticos
    async function enviarRecordatorios() {
      try {
        // Obtener citas para el día siguiente
        const manana = new Date();
        manana.setDate(manana.getDate() + 1);
        const fechaManana = manana.toISOString().split('T')[0];
        
        const { data: citas, error } = await supabase
          .from('citas')
          .select('*')
          .eq('fecha', fechaManana)
          .eq('estado', 'pendiente');
        
        if (error) throw error;
        
        if (citas && citas.length > 0) {
          // Simular envío de recordatorios
          citas.forEach(cita => {
            console.log(`Enviando recordatorio a ${cita.nombre} (${cita.telefono}) para ${cita.fecha} a las ${cita.hora}`);
          });
          
          mostrarNotificacion(`Recordatorios enviados para ${citas.length} citas`, 'success');
        }
      } catch (error) {
        console.error('Error al enviar recordatorios:', error);
        mostrarNotificacion('Error al enviar recordatorios', 'error');
      }
    }

    // Inicialización del panel
    async function inicializarPanel() {
      try {
        const accesoPermitido = await verificarAccesoBarbero();
        if (!accesoPermitido) {
          window.location.href = 'index.html';
          return;
        }

        // Mostrar botón de cerrar sesión si ya está autenticado
        if (sessionStorage.getItem('barberoAutenticado') === 'true') {
          mostrarBotonCerrarSesion();
        }

        // Configurar eventos y cargar citas
        document.getElementById('buscador')?.addEventListener('input', filtrarCitas);
        document.getElementById('filtro-estado')?.addEventListener('change', filtrarCitas);
        document.getElementById('filtro-barbero')?.addEventListener('change', filtrarCitas);
        document.getElementById('btn-exportar')?.addEventListener('click', exportarCitas);
        
        await cargarCitas();
        conectarWebsockets();
        inicializarCalendario();
        configurarTema();
        configurarPestanas();
        configurarTurnos();
        configurarValoraciones();
        configurarRedesSociales();
        
        // Programar recordatorios diarios a las 8 AM
        const ahora = new Date();
        const horaRecordatorio = new Date();
        horaRecordatorio.setHours(8, 0, 0, 0);
        
        if (horaRecordatorio > ahora) {
          setTimeout(() => {
            enviarRecordatorios();
            setInterval(enviarRecordatorios, 24 * 60 * 60 * 1000); // Diario
          }, horaRecordatorio - ahora);
        } else {
          setTimeout(() => {
            enviarRecordatorios();
            setInterval(enviarRecordatorios, 24 * 60 * 60 * 1000); // Diario
          }, (24 * 60 * 60 * 1000) - (ahora - horaRecordatorio));
        }
        
      } catch (error) {
        console.error('Error en inicialización:', error);
        mostrarNotificacion('Error al inicializar el panel', 'error');
      }
    }

    // Iniciar cuando el DOM esté listo
    document.addEventListener('DOMContentLoaded', inicializarPanel);
  </script>
</body>
</html>
